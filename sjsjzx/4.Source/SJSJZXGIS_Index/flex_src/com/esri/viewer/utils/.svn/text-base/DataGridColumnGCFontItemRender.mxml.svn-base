<?xml version="1.0" encoding="utf-8"?>

<mx:TextArea	xmlns:fx="http://ns.adobe.com/mxml/2009" 
				xmlns:s="library://ns.adobe.com/flex/spark" 
				xmlns:mx="library://ns.adobe.com/flex/mx" 
				xmlns:supportClasses="com.esri.ags.skins.supportClasses.*"
				width="100%"
				editable="false"
				borderVisible="false"
				verticalScrollPolicy="off"
				contentBackgroundAlpha="0" 
				wordWrap="true"
				change="changeHandler(event)"
				mouseWheel="textarea_mouseWheelHandler(event)"
				textAlign="left" link="text_linkHandler(event)">
	
	<fx:Script>
		<![CDATA[
			import com.esri.viewer.AppEvent;
			import com.esri.viewer.ViewerContainer;
			
			import mx.controls.Alert;
			import mx.controls.DataGrid;
			import mx.utils.StringUtil;
			
			override public function set data(value:Object) : void
			{
				super.data = value;
				var my_css:StyleSheet = new StyleSheet();
				var byteArr:ByteArray=new ByteArray();
				addStyle("a:hover", 
					{  						
						"color":"#FF0000"
					}, 
					my_css);
				this.styleSheet=my_css;
				if(value)
				{
					//通过Label组件的htmlText属性，结合html标签自定义字体颜色 0000FF
					var pass_no:String="";
					var title:String="";
					var plan_num:String="";
					var stringLength:int=0;
					if(value.type=="gcfw"){	
						pass_no=value.pass_no;
						stringLength=countStringLength(pass_no);
						for(var i:int=0;i<46-stringLength;i++){
							pass_no+=" ";
						}						
						value.project_name=value.project_name.replace("\n","");	
						
						this.htmlText ="<textformat blockindent='12px' rightmargin='10px'><font color=\"#333\">"+value.project_name+"</font>\n"+"<font color=\"#999999\">"+pass_no+ "</font>\n"+
							"<font face='宋体' letterspacing='1px'>                   </font><a href=\"event:gcfw_mx\"><u><font color=\"#053a7c\">明细</font></u></a><font face='宋体' letterspacing='1px'> </font>"+
							"<a href=\"event:gcfw_jz\"><u><font color=\"#053a7c\">建筑</font></u></a><font face='宋体' letterspacing='1px'> </font>"+
							"<a href=\"event:gcfw_xg\"><u><font color=\"#053a7c\">详规</font></u></a><font face='宋体' letterspacing='1px'> </font>" +
							"<a href=\"event:gcfw_xz\"><u><font color=\"#053a7c\">选址</font></u></a><font face='宋体' letterspacing='1px'> </font>"+
							"<a href=\"event:gcfw_yd\"><u><font color=\"#053a7c\">用地</font></u></a><font face='宋体' letterspacing='1px'> </font></textformat>";   
						
					}else if(value.type=="xzfw"){	
						pass_no=value.pass_no;
						stringLength=countStringLength(pass_no);
						for(var i:int=0;i<46-stringLength;i++){
							pass_no+=" ";
						}						
						value.project_name=value.project_name.replace("\n","");	
						
						this.htmlText ="<textformat blockindent='12px' rightmargin='10px'><font color=\"#333\">"+value.project_name+"</font>\n"+"<font color=\"#999999\">"+pass_no+ "</font>\n"+
							"<font face='宋体' letterspacing='1px'>                          </font><a href=\"event:xzfw_mx\"><u><font color=\"#053a7c\">明细</font></u></a><font face='宋体' letterspacing='1px'> </font>"+
							"<a href=\"event:xzfw_xg\"><u><font color=\"#053a7c\">详规</font></u></a><font face='宋体' letterspacing='1px'> </font>"+
							"<a href=\"event:xzfw_yd\"><u><font color=\"#053a7c\">用地</font></u></a><font face='宋体' letterspacing='1px'> </font>"+
							"<a href=\"event:xzfw_gc\"><u><font color=\"#053a7c\">工程</font></u></a><font face='宋体' letterspacing='1px'> </font></textformat>";   
						
					}else if(value.type=="ydfw"){	
						pass_no=value.pass_no;
						stringLength=countStringLength(pass_no);
						for(var i:int=0;i<46-stringLength;i++){
							pass_no+=" ";
						}						
						value.project_name=value.project_name.replace("\n","");			
						
						this.htmlText ="<textformat blockindent='12px' rightmargin='10px'><font color=\"#333\">"+value.project_name+"</font>\n"+"<font color=\"#999999\">"+pass_no+ "</font>\n"+
							"<font face='宋体' letterspacing='1px'>                          </font><a href=\"event:ydfw_mx\"><u><font color=\"#053a7c\">明细</font></u></a><font face='宋体' letterspacing='1px'> </font>"+
							"<a href=\"event:ydfw_xg\"><u><font color=\"#053a7c\">详规</font></u></a><font face='宋体' letterspacing='1px'> </font>"+
							"<a href=\"event:ydfw_xz\"><u><font color=\"#053a7c\">选址</font></u></a><font face='宋体' letterspacing='1px'> </font>"+
							"<a href=\"event:ydfw_gc\"><u><font color=\"#053a7c\">工程</font></u></a><font face='宋体' letterspacing='1px'> </font></textformat>";   
						
					}
					//this.addEventListener(TextEvent.LINK,linkClickEvent);
				}
				//				this.height = this.textHeight*4+10;
			} 
			
			private function countStringLength(src:String):int
			{
				var length:int = 0;
				var byteArr:ByteArray=new ByteArray();
				for (var i:int = 0;i < src.length; i++){
					byteArr.clear();
					byteArr.writeUTFBytes(src.charAt(i));
					if(byteArr.length>=2){
						length+=2;
					}else{
						length+=1;
					}
				}
				
				return length;
			}
			private function linkClickEvent(event:TextEvent):void
			{
				ViewerContainer.dispatchEvent(new AppEvent(AppEvent.GHDataGridClick,event.text));
			}
			
			
			protected function text_linkHandler(event:TextEvent):void
			{
				ViewerContainer.dispatchEvent(new AppEvent(AppEvent.GHDataGridClick,event.text));
			}
			
			
			protected function textarea_mouseWheelHandler(event:MouseEvent):void
			{
				// TODO Auto-generated method stub.
				var displayObject:DisplayObjectContainer = this.parent ;
				displayObject.dispatchEvent(event);
			}
			public static  function addStyle(styleName:String,style:Object,styleSheet:StyleSheet):void{ 
				styleSheet.setStyle(styleName,style); 
			} 
			
			
			protected function changeHandler(event:Event):void
			{
				// TODO Auto-generated method stub
				invalidateSize();
			}
			override protected function measure():void{
				super.measure();
				this.htmlText=mx.utils.StringUtil.trim(this.htmlText);
				this.measuredHeight = measuredMinHeight = textField.getExplicitOrMeasuredHeight() +
					borderMetrics.top + borderMetrics.bottom;
				if(this.measuredHeight>50&&this.measuredHeight<70){
					this.measuredHeight=65;
				}else{
					this.measuredHeight=75;
				}
			}
			
		]]>
	</fx:Script>
</mx:TextArea>